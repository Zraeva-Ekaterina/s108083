---
title: "Лабораторная работа 1"
author: "Зраева Екатерина"
date: "01 12 2020"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F)
library('Hmisc')          # для расчёта корреляционной матрицы
library('corrplot')       # визуализация корреляционных матриц: corrplot()
library('nortest')        # для теста Андерсона-Дарлинга ad.test()
library('knitr')
```
Показатели:

- y - ВРП 2015
- x1 - Инвестиции в основной капитал 2014
- x2 - Расходы консолидированных бюджетов субъектов Российской Федерации: на национальную экономику 2014
- x3 - Использование информационных и коммуникационных технологий в организациях: персональные компьютеры 2014
- x4 - Внутренние затраты на научные исследования и разработки 2014

Источник данных: <https://www.gks.ru/folder/210/document/13204>

```{r}
DF<-read.csv2("Data_Zraeva.csv",
              encoding = "UTF-8",
                        # первый столбец – названия наблюдений
              stringsAsFactors = F,   # не делать факторы
              na.strings = '')
```

Исходные данные для работы хранятся в файле Data_Zraeva.csv.

Дата сбора данных: 30.11.20

Количество наблюдений:

В исходной таблице количество строк, столбцов - 
`r dim(DF)` соответственно. Оставим исходную таблицу без изменений, создав фрейм
«reg.df», в который войдут только нужные нам строки и столбцы, а также фрейм
«reglog.df», в который войдут логарифмированные данные.

Проведем анализ собранных данных:

Посмотрим, насколько нормально распределение исходных
показателей. Для этого построим гистограммы плотности распределения
и проведём статистический тест Шапиро-Уилка на нормальность.

```{r}
reg.df <- DF[as.numeric(row.names(DF)) < 1000, -1]
# выбрасываем пропущенные
reg.df <- na.omit(reg.df)
# строим гистограммы на одном полотне 
par(mfrow = c(3, 2))           # разбить полотно на 4 части, 2x2
par(oma = c(0, 0, 1.5, 0))     # внешние поля общего полотна
par(mar = c(4, 4, 0.5, 0.5))   # внутренние поля каждого графика

# цикл по номерам столбцов с количественными переменными
for (i in 3:7) {
  # данные -- i-ый столбец фрейма
  x <- reg.df[, i]
  
  # гистограмма
  hist(x,
       freq = F,            # по вертикали – плотность (доля)
       col = 'wheat',       # цвет заливки
       xlab = colnames(reg.df)[i],     # название оси X – название столбца 
       ylab = 'Плотность',             # название оси Y
       main = '')                      # без заголовка
  
  # теоретическая плотность
  curve(dnorm(x, mean = mean(x), sd = sd(x)), col = 'darkblue', 
        lwd = 2, add = TRUE)
}

# общий заголовок для всех графиков
title(main = 'Гистограммы распределения показателей', 
      outer = TRUE, cex = 1.5)

# вернуть настройки обратно, 1x1
par(mfrow = c(1, 1))
```
```{r}
peremennaia <- sapply(reg.df[, 3:7], function (x) { round(shapiro.test(x)$statistic, 2)})
# вывод в таблицу
table <- data.frame(peremennaia)
kable(table)
```
Все переменные не подчиняются нормальному распределению.  Судя по гистограммам, распределения
всех показателей сильно скошены (асимметричны) по сравнению
с нормальным законом. Кроме того, показатели имеют более островершинные
распределения по сравнению с нормальным законом.

Протестируем показатели на нормальность. Нулевая гипотеза теста
Шапиро-Уилка: распределение соответствует нормальному закону.
Альтернативная: распределение ненормально. Проверим гипотезу для
переменной y на уровне значимости 0,05.
p.value=1.83e-17<0,05, следовательно, нулевая гипотеза 
отвергается: распределение ненормально.

Для выявления взаимосвязей между парами показателей
удобно использовать графики взаимного разброса.

```{r}
pairs(reg.df[3:7],     # фрейм без первого столбца-фактора
      pch = 21,         # тип символов для точек
      col = rgb(0, 0, 1, alpha = 0.4),   # цвет заливки точек
      bg = rgb(0, 0, 1, alpha = 0.4),    # цвет границы точек
      cex = 1.1)                 # масштаб символов для точек

```

Линейная положительная корреляция заметна между переменными y(ВРП) и x1(Инвестиции в основной капитал), y(ВРП) и x2(Расходы на национальную экономику)

Чтобы подтвердить или опровергнуть эти предположения, рассчитаем
корреляционную матрицу и проверим на значимость коэффициенты
корреляции.

```{r}
# сохраняем корреляционную матрицу
matrix.cor <- cor(reg.df[3:7])

# сохраняем p-значения
matrix.p <- rcorr(as.matrix(reg.df[3:7]))$P

corrplot(matrix.cor,  # сама корреляционная матрица
         order = 'original',  # порядок отображения показателей 
         # в матрице
         method = c("shade"),
         addshade = "positive",
         diag = F,           # не отображать значения на главной 
         # диагонали
         p.mat = matrix.p,   # p-значения
         insig = 'blank',     # метод отображения незначимых
         sig.level = 0.05)    # уровень значимости
```

Сильная линейная связь между всеми парами перменных: У, х1, х2, между остальными парами связь незначима, поэтому на графике не отображается.


Проведем анализ логарифмированных данных:

```{r}
reglog.df<-log10(reg.df[3:7])
par(mfrow = c(3, 2))
par(oma = c(0, 0, 1.5, 0))
par(mar = c(4, 4, 0.5, 0.5)) 
for (i in 1:5) {
 
  x <- reglog.df[, i]
  
 
  hist(x,
       freq = F,           
       col = 'wheat',      
       xlab = colnames(reglog.df)[i],    
       ylab = 'Density',            
       main = '')                      
  
 
  curve(dnorm(x, mean = mean(x), sd = sd(x)), col = 'darkblue', 
        lwd = 2, add = TRUE)
}


title(main = 'Histograms of the distribution of indicators', 
      outer = TRUE, cex = 1.5)



par(mfrow = c(1, 1))
```

Переменная х4 стала наиболее выражено подчиняться нормальному закону распределения, другие показатели также стали чуточку ближе к нормальному распределению, но они сильно сдвинуты.

```{r}
peremennaialog <- sapply(reglog.df[, 1:5], function (x) { round(shapiro.test(x)$statistic, 2)})
table1 <- data.frame(peremennaialog)
kable(table1)

```

p.value=1.37e-06<0,05, нулевая гипотеза по-прежнему 
отвергается: распределение ненормально.

```{r}
pairs(reglog.df[1:5],   
      pch = 21,         
      col = rgb(0, 0, 1, alpha = 0.4),   
      bg = rgb(0, 0, 1, alpha = 0.4),   
      cex = 1.1)       
```

Четко отслеживается положительная линейная взаимосвязь между у и х1, связь между у и х2, у и х3 также стала заметнее, возможна связь между у и х4.
Чтобы подтвердить или опровергнуть эти предположения, рассчитаем
корреляционную матрицу и проверим на значимость коэффициенты
корреляции.
```{r}
matrix.cor <- cor(reglog.df[1:5])


matrix.p <- rcorr(as.matrix(reglog.df[1:5]))$P


corrplot(matrix.cor, 
         method = c("shade"),
         addshade = "positive", 
         order = 'original',  
        
         diag = F,           
        
         p.mat = matrix.p,  
         insig = 'blank',    
         sig.level = 0.05)   
```

Корреляционная матрица выделила 3 показателя оказывающих наиболее сильное влияние на результативный признак у. Это показатели х1, х2, х4. Также заметна связь между пказателями х1 и х2, х1 и х4, ч2 и ч4.



